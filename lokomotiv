#!/bin/bash

# Colores estándar
negro="\e[30m"
rojo="\e[31m"
verde="\e[32m"
naranja="\e[33m"
azul="\e[34m"
magenta="\e[35m"
cyan="\e[36m"
blanco="\e[37m"

# Colores brillantes / claros
gris="\e[90m"
rojo_claro="\e[91m"
verde_claro="\e[92m"
amarillo_claro="\e[93m"
azul_claro="\e[94m"
magenta_claro="\e[95m"
cyan_claro="\e[96m"
blanco_claro="\e[97m"

# Reset de color
reset="\e[0m"

SOCIAL_FILE="social.txt"
CUSTOM_FILE="custom.txt"

USER_AGENT="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"

# Salir
trap "echo; echo 'Saliendo del script'; exit 1" INT

# ===== Funciones =====

check_profile() {
    url=$1
    sitio=$2
    code=$(curl -s -o /dev/null -w "%{http_code}" -A "$USER_AGENT" -L "$url")
    contenido=$(curl -s -L -A "$USER_AGENT" "$url")

    if [[ "$sitio" == "Instagram" ]]; then
        if echo "$contenido" | grep -q "Sorry, this page isn’t available." ; then return 1; fi
    elif [[ "$sitio" == "TikTok" ]]; then
        if echo "$contenido" | grep -q "Couldn't find this account" ; then return 1; fi
    elif [[ "$sitio" == "Twitter" ]]; then
        if echo "$contenido" | grep -q "This account doesn’t exist" ; then return 1; fi
    elif [[ "$sitio" == "LinkedIn" ]]; then
        if echo "$contenido" | grep -q "profile not found" ; then return 1; fi
    else
        [[ $code -ne 200 ]] && return 1
    fi
    return 0
}

generate_url() {
    local url="$1"
    local usuario="$2"
    if [[ "$url" == *"@@@"* ]]; then
        echo "${url/@@@/@$usuario}"
    elif [[ "$url" == *"@@"* ]]; then
        echo "${url/@@/$usuario}"
    elif [[ "$url" == *"{user}"* ]]; then
        echo "${url/\{user\}/$usuario}"
    else
        echo "${url}${usuario}"
    fi
}

scan_social() {
    usuario=$1
    archivo=$2
    echo "Buscando a:"
    echo -e "${cyan}[/] $usuario${reset}"
    echo

    categoria_actual=""
    while IFS= read -r line; do
        [[ -z "$line" ]] && continue
        if [[ "$line" =~ ^==== ]]; then
            categoria_actual="$line"
            echo -e "\n$line"
            continue
        fi

        IFS=";" read -r nombre url <<< "$line"
        perfil=$(generate_url "$url" "$usuario")

        check_profile "$perfil" "$nombre"
        if [ $? -eq 0 ]; then
            echo -e "${verde}[+] $nombre: $perfil${reset}"
        else
            echo -e "${naranja}[-] $nombre: No hay registro (⚠) ${reset}"
        fi
    done < "$archivo"
    echo
    post_scan_menu
}

scan_custom() {
    usuario=$1
    archivo=$2
    echo "Buscando al usuario '$usuario' en $(basename $archivo) ..."
    echo

    while IFS=";" read -r nombre url; do
        [[ -z "$nombre" || "$nombre" =~ ^# ]] && continue
        perfil=$(generate_url "$url" "$usuario")
        code=$(curl -s -o /dev/null -w "%{http_code}" -A "$USER_AGENT" -L "$perfil")
        if [ $code -eq 200 ]; then
            echo -e "${verde}[+] $nombre: $perfil${reset}"
        else
            echo -e "${naranja}[-] $nombre: No hay registro (⚠ Posible falso negativo)${reset}"
        fi
    done < "$archivo"
    echo
    post_scan_menu
}

# Función para menú posterior a la búsqueda
post_scan_menu() {
    echo "°°°°°°°°°°°°°°°°°°°°°°°°°°°°°"
    echo "1. Regresar al menú"
    echo "2. Cerrar interfaz"
    echo "°°°°°°°°°°°°°°°°°°°°°°°°°°°°°"
    read -p "Opción: " opcion_post
    case $opcion_post in
        1) return ;; # vuelve al menú principal
        2) echo "Cerrando interfaz..."; kill -INT $$ ;;
        *) echo "Opción inválida, regresando al menú"; sleep 1 ;;
    esac
}

# Mostrar menú principal
show_menu() {
    clear
    # Mantengo tu ASCII art y decoración intacta
    echo "                       "
    echo "                       "
    echo "                       "
    echo -e "${verde}888       .d88888b.  888    d8P   .d88888b.  888b     d888  .d88888b.  88888888888 8888888 888     888${reset}"
    echo -e "${verde_claro}888      d88P\" \"Y88b 888   d8P   d88P\" \"Y88b 8888b   d8888 d88P\" \"Y88b     888       888   888     888${reset}"
    echo -e "${blanco}888      888     888 888  d8P    888     888 88888b.d88888 888     888     888       888   888     888${reset}"
    echo -e "${blanco_claro}888      888     888 888d88K     888     888 888Y88888P888 888     888     888       888   Y88b   d88P${reset}"
    echo -e "${rojo_claro}888      888     888 8888888b    888     888 888 Y888P 888 888     888     888       888    Y88b d88P${reset}"
    echo -e "${rojo}888      888     888 888  Y88b   888     888 888  Y8P  888 888     888     888       888     Y88o88P${reset}"
    echo -e "${rojo}888      Y88b. .d88P 888   Y88b  Y88b. .d88P 888   \"   888 Y88b. .d88P     888       888      Y888P${reset}"
    echo -e "${rojo}88888888  \"Y88888P\"  888    Y88b  \"Y88888P\"  888       888  \"Y88888P\"      888     8888888     Y8P${reset}"
    echo "                       "
    echo -e "${blanco}V1.0"  
    echo "By: SrWyatt."
    echo "                      "
    echo " "
    echo "  "
    echo "===================================="
    echo -e "${naranja}⚠ Algunos perfiles podrían tener un falso negativo.${reset}"
    echo -e "${naranja}Actualmente se está trabajando en solucionar posibles errores.${reset} "
    echo "===================================="
    echo ""
    echo ""
    echo "°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°"
    echo "Elige una de las opciones disponibles:"
    echo "°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°"
    echo "1. Búsqueda básica"
    echo ""
    echo "2. Búsqueda avanzada"
    echo ""
    echo "3. Búsqueda personalizada"
    echo ""
    echo "666. Salir (Ctrl+C)"
    echo "                       "
    echo "°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°"
    read -p "Opción: " opcion
    echo "°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°°"
    echo "   "
}

# Menú principal
while true; do
    show_menu
    case $opcion in
        1)
            read -p "Introduce el nombre de usuario: " user
            grep -E "Facebook|Instagram|Twitter|TikTok|GitHub|LinkedIn" "$SOCIAL_FILE" > basic.tmp
            scan_social "$user" basic.tmp
            rm -f basic.tmp
            ;;
        2)
            read -p "Introduce el nombre de usuario: " user
            scan_social "$user" "$SOCIAL_FILE"
            ;;
        3)
            if [ ! -f "$CUSTOM_FILE" ]; then
                echo "Archivo $CUSTOM_FILE no existe."
                read -p "ENTER para continuar..."
                continue
            fi
            read -p "Introduce el nombre de usuario: " user
            scan_custom "$user" "$CUSTOM_FILE"
            ;;
        666)
            echo "Saliendo..."
            kill -INT $$
            ;;
        *)
            echo "Opción inválida"
            sleep 1
            ;;
    esac
done
